  name: Conectar a EC2

  on:
    push:
      branches:
        - develop

  jobs:
    deploy:
      runs-on: ubuntu-latest

      steps:
        - name: Checkout c√≥digo fuente
          uses: actions/checkout@v2

        - name: Construir imagen Docker
          run: |
            docker build -t mi-app-fastapi .
            docker images

        - name: Conectar a EC2 y desplegar
          env:
            AWS_ACCESS_KEY_ID: ${{ secrets.AWS_ACCESS_KEY_ID }}
            AWS_REGION: ${{ secrets.AWS_REGION }}
            AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_ACCESS_KEY }}

          run: |
            docker run -d --name conectarapi_user mi-app-fastapi
            ssh -o StrictHostKeyChecking=no -i ${{ secrets.SSH_SECRET_BASE64 }} ec2-user@18.229.135.176
